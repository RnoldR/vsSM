Simple deterministic finite state machine.
